<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WDK LAB ë°”í…€ì—… ìŠ¤ì½”ì–´ì¹´ë“œ v4.0</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }

        .skeleton {
            animation: pulse 2s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }

        @keyframes pulse {
            50% {
                opacity: .5;
            }
        }

        .score-positive {
            color: #16a34a;
        }

        .score-negative {
            color: #dc2626;
        }

        .score-neutral {
            color: #64748b;
        }

        .tooltip {
            position: relative;
            display: inline-block;
            cursor: help;
        }

        .tooltip .tooltiptext {
            visibility: hidden;
            width: 250px;
            background-color: #2d3748;
            color: #fff;
            text-align: left;
            border-radius: 6px;
            padding: 8px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -125px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 12px;
            line-height: 1.5;
            white-space: pre-wrap;
        }

        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }

        .rank-gold {
            background-color: rgba(251, 191, 36, 0.1);
        }

        .rank-silver {
            background-color: rgba(156, 163, 175, 0.1);
        }

        .rank-bronze {
            background-color: rgba(180, 83, 9, 0.05);
        }
    </style>
</head>

<body class="bg-slate-100 dark:bg-slate-900 text-slate-800 dark:text-slate-200">

    <div class="container mx-auto p-4 sm:p-6 lg:p-8">
        <header class="text-center mb-8">
            <h1 class="text-3xl sm:text-4xl font-bold text-slate-900 dark:text-white">WDK LAB ë°”í…€ì—… ìŠ¤ì½”ì–´ì¹´ë“œ v4.0</h1>
            <p class="text-slate-500 dark:text-slate-400 mt-2">ì •ëŸ‰ì  ì—°ì†í˜• ì ìˆ˜ ê¸°ë°˜ ìµœì •ì˜ˆ ìš”ì› ì„ ë°œ ì‹œìŠ¤í…œ</p>
            <p class="text-xs text-slate-400 dark:text-slate-500 mt-1">ğŸ“… yfinance ê¸°ë°˜ ë°ì´í„° | Python ìŠ¤í¬ë¦½íŠ¸ë¡œ ìƒì„±</p>
            <p id="data-status" class="text-xs text-emerald-500 mt-1">ğŸ“¡ ë°ì´í„° ë¡œë”© ì¤‘...</p>
            <div class="mt-4 flex justify-center items-center space-x-4">
                <a href="./dashboard_topdown.html" class="text-emerald-500 hover:text-emerald-600 transition-colors">â†
                    íƒ‘ë‹¤ìš´ ëŒ€ì‹œë³´ë“œë¡œ ëŒì•„ê°€ê¸°</a>
                <button id="refresh-btn"
                    class="px-3 py-1 bg-blue-500 hover:bg-blue-600 text-white rounded text-sm transition-colors"
                    title="ìƒˆë¡œê³ ì¹¨">ğŸ”„ ìƒˆë¡œê³ ì¹¨</button>
            </div>

        </header>

        <section id="scoreboard">
            <div class="bg-white dark:bg-slate-800 rounded-2xl shadow-lg p-6">
                <div class="overflow-x-auto">
                    <table class="w-full text-sm text-left">
                        <thead
                            class="text-xs text-slate-700 dark:text-slate-400 uppercase bg-slate-50 dark:bg-slate-700">
                            <tr>
                                <th class="px-4 py-3">ìˆœìœ„</th>
                                <th class="px-4 py-3">ì¢…ëª©</th>
                                <th class="px-4 py-3 text-center">ëª¨ë©˜í…€ (45%)</th>
                                <th class="px-4 py-3 text-center">í€ë”ë©˜íƒˆ (35%)</th>
                                <th class="px-4 py-3 text-center">ë°¸ë¥˜ì—ì´ì…˜ (20%)</th>
                                <th class="px-4 py-3 text-center">ìµœì¢… ì ìˆ˜</th>
                            </tr>
                        </thead>
                        <tbody id="scoreboard-body">
                            <!-- Data will be loaded here -->
                        </tbody>
                    </table>
                </div>
                <p class="text-xs text-slate-400 mt-4 text-right">Last Updated: <span id="last-updated">-</span></p>
            </div>
        </section>
    </div>

    <script>
        const scoreboardBody = document.getElementById('scoreboard-body');
        const lastUpdatedEl = document.getElementById('last-updated');
        const dataStatus = document.getElementById('data-status');

        function getScoreClass(score) {
            if (score > 0.3) return 'score-positive';
            if (score < -0.3) return 'score-negative';
            return 'score-neutral';
        }

        function getRankClass(rank) {
            if (rank === 1) return 'rank-gold';
            if (rank <= 3) return 'rank-silver';
            if (rank <= 5) return 'rank-bronze';
            return '';
        }

        function formatScore(score) {
            if (score === null || score === undefined) return 'N/A';
            return score >= 0 ? `+${score.toFixed(2)}` : score.toFixed(2);
        }

        function renderBoard(data) {
            let html = '';

            data.forEach(item => {
                const rankClass = getRankClass(item.rank);

                if (item.error) {
                    html += `
                        <tr class="border-b dark:border-slate-700 ${rankClass}">
                            <td class="px-4 py-4 font-bold text-lg text-center align-middle">${item.rank}</td>
                            <td class="px-4 py-4 font-bold text-slate-900 dark:text-slate-100 align-middle">${item.ticker}</td>
                            <td colspan="4" class="px-4 py-4 text-center text-red-500 align-middle">ë°ì´í„° ë¡œë”© ì‹¤íŒ¨</td>
                        </tr>
                    `;
                    return;
                }

                const s = item.scores;
                const raw = s.raw || {};

                // Tooltips
                const momTooltip = `Price: $${raw.price?.toFixed(2) || '-'}\nSMA200: $${raw.sma200?.toFixed(2) || '-'}\n52W Change: ${((raw['52w_change'] || 0) * 100).toFixed(1)}%`;
                const fundTooltip = `EPS Growth: ${((raw.eps_growth || 0) * 100).toFixed(1)}%\nProfit Margin: ${((raw.profit_margin || 0) * 100).toFixed(1)}%\nROE: ${((raw.roe || 0) * 100).toFixed(1)}%`;
                const valTooltip = `P/E: ${raw.pe?.toFixed(1) || '-'}\nForward P/E: ${raw.forward_pe?.toFixed(1) || '-'}\nPEG: ${raw.peg?.toFixed(2) || '-'}`;

                html += `
                    <tr class="border-b dark:border-slate-700 ${rankClass}">
                        <td class="px-4 py-4 font-bold text-lg text-center align-middle">${item.rank}</td>
                        <td class="px-4 py-4 font-bold text-slate-900 dark:text-slate-100 align-middle">${item.ticker}</td>
                        <td class="px-4 py-4 text-center align-middle">
                            <div class="tooltip font-bold ${getScoreClass(s.momentum)}">${formatScore(s.momentum)}<span class="tooltiptext">${momTooltip}</span></div>
                        </td>
                        <td class="px-4 py-4 text-center align-middle">
                            <div class="tooltip font-bold ${getScoreClass(s.fundamental)}">${formatScore(s.fundamental)}<span class="tooltiptext">${fundTooltip}</span></div>
                        </td>
                        <td class="px-4 py-4 text-center align-middle">
                            <div class="tooltip font-bold ${getScoreClass(s.valuation)}">${formatScore(s.valuation)}<span class="tooltiptext">${valTooltip}</span></div>
                        </td>
                        <td class="px-4 py-4 text-center align-middle">
                            <span class="font-bold text-lg ${getScoreClass(s.final)}">${formatScore(s.final)}</span>
                        </td>
                    </tr>
                `;
            });

            scoreboardBody.innerHTML = html;
        }

        async function loadData() {
            dataStatus.textContent = 'ğŸ“¡ ë°ì´í„° ë¡œë”© ì¤‘...';
            dataStatus.className = 'text-xs text-blue-500 mt-1';

            try {
                // JSON íŒŒì¼ ë¡œë“œ (ìƒëŒ€ ê²½ë¡œ)
                const response = await fetch('./bottomup_data.json?' + Date.now());

                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }

                const json = await response.json();

                renderBoard(json.data);
                lastUpdatedEl.textContent = json.updated_display;

                dataStatus.textContent = `âœ… ë¡œë”© ì™„ë£Œ! (${json.count}/${json.total})`;
                dataStatus.className = 'text-xs text-emerald-500 mt-1';

            } catch (error) {
                console.error('Error loading data:', error);
                dataStatus.textContent = `âŒ ë°ì´í„° ë¡œë”© ì‹¤íŒ¨: ${error.message}`;
                dataStatus.className = 'text-xs text-red-500 mt-1';

                scoreboardBody.innerHTML = `
                    <tr>
                        <td colspan="6" class="px-4 py-8 text-center text-red-500">
                            <p class="text-lg font-bold">ë°ì´í„° íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤</p>
                            <p class="text-sm mt-2">í„°ë¯¸ë„ì—ì„œ <code class="bg-slate-200 dark:bg-slate-700 px-2 py-1 rounded">python generate_bottomup_data.py</code> ë¥¼ ì‹¤í–‰í•´ì£¼ì„¸ìš”</p>
                        </td>
                    </tr>
                `;
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            loadData();

            document.getElementById('refresh-btn').addEventListener('click', () => {
                loadData();
            });
        });
    </script>
</body>

</html>